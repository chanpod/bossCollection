var _ = require('lodash');
var q = require('q');

var myExports = {
    
    saveSession: (req, res) => {
        var defer = q.defer();
        
        console.log("Updating session");
        console.log("User: " + req.session.user.name);
        
        res.cookie('user', req.session.user, { maxAge: 90000000 });
        
        req.session.save(() => {
                        
            // update the user's login cookies if they exists //
            if (req.session.user != undefined) {                
                
                console.log("Session update complete");
                defer.resolve(req.session.user);                
            }
            else{
                console.log("Uh oh, session Broke. No user defined?");
                defer.reject("No session user defined.")
            }
        });
        
        return defer.promise;
    },
    handleErrors: (err) => {
        var errObject = {}
        if (err.message) {
            errObject = {message: err.message };
        }
        else {
            errObject = {message: err };
        }
        
        return errObject;
    },
    userExist: (req) => {

        if (req.session.user) {
            return true;
        }
        else {
            return false;
        }
    },
    userHasGuild: (req) => {
        
        var hasGuild = false;
        
        if (myExports.userExist(req)) {

            if (req.session.user.guild) {

                hasGuild = true;
            }
        }
        
        return hasGuild;
    }
}

module.exports = myExports;