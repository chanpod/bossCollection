"use strict";angular.module("BossCollection",["BossCollection.controllers","BossCollection.services","BossCollection.directives","BossCollection.filters","BossCollection.forums","BossCollection.attendance","ngRoute","ngResource","btford.socket-io","ngCookies","ngMaterial"]).factory("mySocket",["socketFactory",function(e){return e()}]).config(["$routeProvider","$locationProvider","$httpProvider","$sceDelegateProvider","$mdThemingProvider",function(e,t,o,n,r){r.theme("default").primaryPalette("deep-orange",{"default":"A700"}).accentPalette("grey",{"default":"900"}),e.when("/",{templateUrl:"home",controller:"homeController"}).when("/strategyRoom/:raid",{templateUrl:"strategyRoom",controller:"strategyRoomController"}).when("/roster",{templateUrl:"roster",controller:"rosterController"}).when("/auth/signup",{templateUrl:"signup",controller:"signupController"}).when("/auth/updateAccount",{templateUrl:"editAccount",controller:"editAccountController"}).when("/auth/application",{templateUrl:"application",controller:"applicationController"}).when("/reviewApplications",{templateUrl:"reviewApplications",controller:"applicationsReviewController"}).when("/createGuild",{templateUrl:"createGuild",controller:"createGuildController"}).when("/joinGuild",{templateUrl:"joinGuild",controller:"joinGuildController"}).when("/manageMembers",{templateUrl:"manageMembers",controller:"manageMembersController"}).otherwise({redirectTo:"/"}),t.hashPrefix("!"),n.resourceUrlWhitelist(["self","https://www.youtube.com/**","https://pagead2.googlesyndication.com"]),t.html5Mode(!0)}]),angular.module("BossCollection.attendance",["ngRoute"]).config(["$routeProvider",function(e){e.when("/attendanceStatistics",{templateUrl:"attendanceStats",controller:"attendanceStatsCtrl"}).when("/whosOut",{templateUrl:"absenceSubmissions",controller:"absenceSubmissionsController"}).when("/auth/absence",{templateUrl:"absence",controller:"absenceReportController"})}]),angular.module("BossCollection.forums",["ngRoute"]).config(["$routeProvider",function(e){e.when("/forum",{templateUrl:"forum",controller:"forumController"}).when("/forum/:forumID",{templateUrl:"thread",controller:"threadController"})}]),angular.module("BossCollection.attendance").factory("absenceService",["$resource","$q","$location","$cookies","$rootScope","siteServices",function(e,t,o,n,r,i){var a=e("/api/absence",{},{}),c=e("/api/absenceByDate",{},{}),l={submitNewAbsence:function(e){var o=t.defer();return i.startLoading(),a.save(e).$promise.then(function(e){o.resolve(e)},function(e){console.log(e),o.reject(e.data)})["finally"](function(){i.loadingFinished()}),o.promise},getAbsences:function(){var e=t.defer();return a.get().$promise.then(function(t){e.resolve(t)},function(t){console.log(t),e.reject(t.data)})["finally"](function(){i.loadingFinished()}),e.promise},getAbsencesByDate:function(e){var o=t.defer();return c.save({date:e}).$promise.then(function(e){o.resolve(e)},function(e){console.log(e),o.reject(e.data)})["finally"](function(){i.loadingFinished()}),o.promise}};return l}]),angular.module("BossCollection.forums").controller("dialogController",["$scope","$location","siteServices","forumService","$mdBottomSheet","$mdDialog","data","userLoginSrvc",function(e,t,o,n,r,i,a,c){e.object={},e.loading=!1,e.replying=!1,e.comment="",e.commentToDelete,e.orderBy="dateCreated",e.init=function(){a?e.object=a:e.object={},c.getUser().then(function(t){e.user=t})},e.cancel=function(){i.cancel()},e.orderByDateCreated=function(){e.orderBy="dateCreated"},e.orderByDateCreatedReversed=function(){e.orderBy="-dateCreated"},e.cancelComment=function(){e.replying=!1},e.cancelCommentEdit=function(e){e.editing=!1},e.saveCommentEdit=function(t){n.editComment(t).then(function(o){e.cancelCommentEdit(t)})},e.confirmDelete=function(t){e.commentToDelete=t,e.confirmDeleteBool=!0},e.deleteComment=function(){n.deleteComment(e.commentToDelete).then(function(t){e.refreshComments()})["catch"](function(e){})["finally"](function(){e.loading=!1,e.confirmDeleteBool=!1})},e.refreshComments=function(){n.getComments(e.object._id).then(function(t){e.object.comments=t.comments})["catch"](function(e){})["finally"](function(){e.loading=!1})},e.cancelCommentDelete=function(){e.commentToDelete={},e.confirmDeleteBool=!1},e.saveComment=function(){var t={message:e.object.newComment,threadId:e.object._id};n.createComment(t).then(function(t){e.object.newComment="",e.object.comments.push(t.comment),e.cancelComment()})},e.openCommentBox=function(){e.replying=!0},e.close=function(){i.hide(e.object)},e.deleteCategory=function(){n.deleteCategory(e.object).then(function(t){e.close(t)})},e.deleteForum=function(){n.deleteForum(e.object).then(function(t){e.close(t)})},e.saveCategory=function(){e.loading=!1,e.object._id?n.editCategory(e.object).then(function(t){e.close(t)})["catch"](function(e){})["finally"](function(){e.loading=!1}):n.createNewCategory({name:e.object.name}).then(function(t){e.close(t)})["catch"](function(e){})["finally"](function(){e.loading=!1})},e.saveThread=function(){var t;e.object._id?(t=e.object,n.editThread(t).then(function(t){e.close(t)})["catch"](function(e){})["finally"](function(){e.loading=!1})):(t={name:e.object.title,forumId:e.object.forum._id,message:e.object.message},n.createThread(t).then(function(t){e.close(t)})["catch"](function(e){})["finally"](function(){e.loading=!1}))},e.formatDate=function(e){var t=moment.utc(e).toDate();return moment(t).format("dddd, MMM D hh:mm")},e.saveForum=function(){if(e.loading=!0,e.object._id){var t=e.object;n.editForum(t).then(function(t){e.close(t)})["catch"](function(e){})["finally"](function(){e.loading=!1})}else{var t={name:e.object.name,categoryId:e.object.object.categoryId};n.createNewForum(t).then(function(t){e.close(t)})["catch"](function(t){e.loading=!1})["finally"](function(){e.loading=!1})}},e.init()}]),angular.module("BossCollection.forums").controller("forumController",["$scope","$location","siteServices","forumService","$mdBottomSheet","$mdDialog","$window",function(e,t,o,n,r,i,a){console.log("Forum Controller loaded"),o.updateTitle("Forums"),e.testListCount=[],e.loading=!1;for(var c=0;5>c;c++)e.testListCount.push(c);e.markdown="",e.init=function(){e.getForums()},e.getForums=function(){return e.loading=!0,n.getForums().then(function(t){e.loading=!1,e.forums=t})["catch"](function(t){e.loading=!1,console.log(t)})},e.newCategory=function(){e.category={},n.openBottomSheet("category").then(function(t){n.removeLocalForums(),e.getForums()}).then(function(){n.cancel()})["catch"](function(e){})},e.editCategory=function(t){n.openBottomSheet("category",t).then(function(t){n.removeLocalForums(),e.getForums()})["catch"](function(e){})},e.deleteCategory=function(t){n.confirmDelete().then(function(e){return e?(console.log("Deleting the category"),n.deleteCategory(t)):void 0}).then(function(t){n.removeLocalForums(),e.getForums()})},e.createForum=function(t){var o=t._id;n.openBottomSheet("forumEdit",{object:{categoryId:o}}).then(function(t){n.removeLocalForums(),e.getForums()})["catch"](function(e){})},e.editForum=function(t){n.openBottomSheet("forumEdit",t).then(function(t){n.removeLocalForums(),e.getForums()})},e.deleteForum=function(t){n.confirmDelete().then(function(e){return e?(console.log("Deleting the forum"),n.deleteForum(t)):void 0}).then(function(t){n.removeLocalForums(),e.getForums()})},e.goToForum=function(e){n.setForum(e),t.url("/forum/"+e._id)},e.init()}]),angular.module("BossCollection.forums").service("forumService",["$location","$mdDialog","$q","$routeParams","siteServices","$mdMedia","$rootScope","$resource",function(e,t,o,n,r,i,a,c){function l(e){var t=o.defer(),n={category:e};return R.save(n).$promise.then(function(e){t.resolve(e)},function(e){t.reject(e)})["finally"](function(){}),t.promise}function s(e){var t=o.defer(),n={category:e};return F.save(n).$promise.then(function(e){t.resolve(e.category)}),t.promise}function u(e){var t=o.defer(),n={category:e};return L.save(n).$promise.then(function(e){t.resolve(e.category)},function(e){t.reject(e)})["finally"](function(){}),t.resolve(e),t.promise}function d(e){A=e}function f(e){var t=o.defer();return m().then(function(o){var n;_(o.categories).forEach(function(t){_.find(t.forums,function(t){t._id==e&&(n=t)})}),t.resolve(n)},function(e){t.reject(e)})["finally"](function(){}),t.promise}function m(){var e=o.defer();return j?e.resolve(j):N.save({}).$promise.then(function(t){j=t.forums,e.resolve(t.forums)},function(t){e.reject(t)}),e.promise}function g(){j=void 0}function h(e){var t=o.defer(),n={forum:e};return I.save(n).$promise.then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)})["finally"](function(){}),t.promise}function p(e){var t=o.defer();return G.save({forum:e}).$promise.then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t.promise}function v(e){var t=o.defer();return P.save({forum:e}).$promise.then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)})["finally"](function(){}),t.promise}function b(){var e=o.defer();return A?e.resolve(A):f(n.forumID).then(function(t){A=t,e.resolve(t)}),e.promise}function y(e){var t=o.defer(),n={forumId:e};return x.save(n).$promise.then(function(e){t.resolve(e.threads)}),t.promise}function w(e){var t=o.defer(),n={thread:e};O.save(n).$promise.then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)})["finally"](function(){})}function C(e){var t=o.defer();return H.save({thread:e}).$promise.then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)})["finally"](function(){}),t.promise}function S(e){var t=o.defer(),n={thread:e};return E.save(n).$promise.then(function(e){t.resolve(e.thread)}),t.promise}function $(e){var t=o.defer();return z.save({comment:e}).$promise.then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)})["finally"](function(){}),t.promise}function B(e){var t=o.defer();return V.save({comment:e}).$promise.then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)})["finally"](function(){}),t.promise}function M(e){var t=o.defer(),n={comment:e};return q.save(n).$promise.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}function k(e){var t=o.defer(),n={threadId:e};return W.save(n).$promise.then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}function D(e,n){var r=o.defer(),i=t.confirm().title("Are you sure you want to delete this?").textContent("This is irreversable once you click Yes!").ariaLabel("Confirm Delete").targetEvent(e).ok("Delete").cancel("Nevermind");return t.show(i).then(function(){r.resolve(!0)},function(e){r.reject(!1)}),r.promise}function T(e,n){var r=o.defer(),a=i("xs")||i("sm");(i("sm")||i("xs"))&&a;return t.show({templateUrl:e,controller:"dialogController",parent:angular.element(document.body),clickOutsideToClose:!1,locals:{data:n},fullscreen:!0}).then(function(e){r.resolve(e)},function(){r.reject()}),r.promise}function U(){t.hide()}var A,j,F=c("/forum/createCategory",{},{}),L=c("/forum/editCategory",{},{}),R=c("/forum/deleteCategory",{},{}),N=c("/forum/getCategories",{},{}),I=c("/forum/deleteForum",{},{}),P=c("/forum/editForum",{},{}),G=c("/forum/createForum",{},{}),E=c("/forum/createThread",{},{}),x=c("/forum/getThreads",{},{}),O=c("/forum/deleteThread",{},{}),H=c("/forum/editThread"),q=c("/forum/createComment",{},{}),W=c("/forum/getComments",{},{}),V=c("/forum/editComment",{},{}),z=c("/forum/deleteComment",{},{});return{setForum:d,confirmDelete:D,openBottomSheet:T,createNewCategory:s,deleteCategory:l,editCategory:u,editForum:v,createNewForum:p,deleteForum:h,cancel:U,getForums:m,removeLocalForums:g,getThreads:y,getCurrentForum:b,deleteThread:w,editThread:C,createThread:S,deleteComment:$,editComment:B,createComment:M,getComments:k}}]),angular.module("BossCollection.attendance").controller("attendanceStatsCtrl",["$scope","$location","userLoginSrvc","absenceService","siteServices","$filter",function(e,t,o,n,r,i){r.updateTitle("Attendance Statistics"),e.absenceHighchartData=[],e.absenceHighchartDrillDownSeries=[],e.late=3,e.absent=1,e.weeksCounted=4,e.raidsPerWeek=3,e.init=function(){e.getAbsences()},e.getAbsences=function(){e.currentlySelected="All absences",e.loading=!0,n.getAbsences().then(function(t){e.loading=!1,e.absences=t.absences,e.calculateAttendance()},function(t){r.showMessageToast(t),e.loading=!1,console.log(t)})},e.calculateAttendance=function(){var t=_.groupBy(e.absences,"user");_(t).forEach(function(t){var o=_.groupBy(t,"type"),n=0,r=0;o.late&&(n=o.late.length||0),o.absent&&(r=o.absent.length||0);var i=e.weeksCounted*e.raidsPerWeek*(e.late+e.absent),a=i-n*e.late-r*e.absent,c=a/i;e.absenceHighchartData.push({name:t[0].user,y:100*c,drilldown:t[0].user});var l=[];_(o.late).forEach(function(t){l.push([t.date,e.late])}),_(o.absent).forEach(function(t){l.push([t.date,e.absent])}),e.absenceHighchartDrillDownSeries.push({name:t[0].user,id:t[0].user,data:l})},this),e.buildHighChart()},e.buildHighChart=function(){$("#container").highcharts({chart:{type:"column"},title:{text:"Member attendance rates"},subtitle:{text:"Click the columns to view dates missed."},xAxis:{type:"category"},yAxis:{title:{text:"Percent attendance"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.1f}%"}}},series:[{name:"Member",colorByPoint:!0,data:e.absenceHighchartData}],drilldown:{series:e.absenceHighchartDrillDownSeries}})},e.init()}]),angular.module("BossCollection.attendance").controller("absenceReportController",["$scope","$location","userLoginSrvc","absenceService","siteServices","$filter",function(e,t,o,n,r,i){moment().day();e.newAbsence={},e.absences={},e.loading=!1,e.typePicked=!1,e.today=moment(),e.dayDesired,e.currentlySelected=moment().format("dddd - Do"),e.toolbar={isOpen:!1,direction:"right"},e.currentlySelected="Today",e.isToolSetOpen=!1,"/auth/absence"==t.url()?r.updateTitle("Report Absence"):r.updateTitle("Upcoming Absences"),e.updateList=function(){e.currentlySelected=moment(e.dayDesired).format("dddd - Do"),e.getAbsencesByDate()},e.formatDate=function(e){return moment.utc(e).format("dddd, MMM D")},e.getAbsences=function(){e.currentlySelected="All absences",e.loading=!0,n.getAbsences().then(function(t){e.loading=!1,e.absences=t.absences},function(t){r.showMessageToast(t),e.loading=!1,console.log(t)})},e.getAbsencesByDate=function(){e.loading=!0,n.getAbsencesByDate(e.dayDesired).then(function(t){e.loading=!1,e.absences=t.absences},function(t){r.showMessageToast(t),e.loading=!1,console.log(t)})},e.submitNewAbsence=function(){null==e.newAbsence.date?r.showMessageModal("Must select a date"):null==e.newAbsence.type?r.showMessageModal("Must select a type: Late or Absent"):n.submitNewAbsence(e.newAbsence).then(function(e){t.path("/whosOut")},function(e){Materialize.toast(e),console.log(e)})}}]),angular.module("BossCollection.attendance").controller("absenceSubmissionsController",["$scope","$location","userLoginSrvc","absenceService","siteServices","$filter",function(e,t,o,n,r,i){moment().day();e.newAbsence={},e.absences={},e.loading=!1,e.typePicked=!1,e.today=moment(),e.dayDesired,e.currentlySelected=moment().format("dddd - Do"),e.toolbar={isOpen:!1,direction:"right"},e.currentlySelected="Today",e.isToolSetOpen=!1,"/auth/absence"==t.url()?r.updateTitle("Report Absence"):r.updateTitle("Upcoming Absences"),e.updateList=function(){e.currentlySelected=moment(e.dayDesired).format("dddd - Do"),e.getAbsencesByDate()},e.formatDate=function(e){return moment.utc(e).format("dddd, MMM D")},e.getAbsences=function(){e.currentlySelected="All absences",e.loading=!0,n.getAbsences().then(function(t){e.loading=!1,e.absences=t.absences},function(t){r.showMessageToast(t),e.loading=!1,console.log(t)})},e.getAbsencesByDate=function(){e.loading=!0,n.getAbsencesByDate(e.dayDesired).then(function(t){e.loading=!1,e.absences=t.absences},function(t){r.showMessageToast(t),e.loading=!1,console.log(t)})},e.submitNewAbsence=function(){null==e.newAbsence.date?r.showMessageModal("Must select a date"):null==e.newAbsence.type?r.showMessageModal("Must select a type: Late or Absent"):n.submitNewAbsence(e.newAbsence).then(function(e){t.path("/whosOut")},function(e){Materialize.toast(e),console.log(e)})}}]),angular.module("BossCollection.forums").controller("threadController",["$scope","$location","siteServices","forumService","$mdBottomSheet","$mdDialog",function(e,t,o,n,r,i){console.log("Thread Controller Loaded"),e.forum={},e.loading=!1,e.orderBy="dateCreated",e.init=function(){e.loading=!0,e.forum=n.getCurrentForum().then(function(t){e.forum=t}).then(function(){return o.updateTitle(e.forum.name+" Forum"),n.getThreads(e.forum)}).then(function(t){e.threads=t})["catch"](function(t){e.loading=!1})["finally"](function(){e.loading=!1})},e.refresh=function(){e.loading=!0,n.getThreads(e.forum).then(function(t){e.loading=!1,e.threads=t})["catch"](function(t){e.loading=!1})},e.deleteThread=function(t){n.confirmDelete().then(function(e){return e?(console.log("Deleting the category"),n.deleteThread(t)):void 0}).then(function(t){e.refresh()})},e.orderByDateCreated=function(){e.orderBy="dateCreated"},e.orderByDateCreatedReversed=function(){e.orderBy="-dateCreated"},e.openThread=function(e){n.getComments(e._id).then(function(t){e.comments=t.comments,n.openBottomSheet("threadComments",e)})},e.createThread=function(){n.openBottomSheet("threadEdit",{forum:e.forum}).then(function(t){e.refresh()})},e.editThread=function(e){n.openBottomSheet("threadEdit",e)},e.goBack=function(){window.history.back()},e.init()}]),angular.module("BossCollection.controllers",[]),angular.module("BossCollection.controllers").controller("homeController",["$scope","$location","$http","$timeout","siteServices","$sce",function(e,t,o,n,r,i){r.updateTitle("Home")}]),angular.module("BossCollection.controllers").controller("navbar",["$scope","$location","$http","userLoginSrvc","$rootScope","$mdSidenav","siteServices",function(e,t,o,n,r,i,a){function c(e){return function(){i(e).toggle()}}function l(){n.getUser().then(function(t){t&&(e.user=t,e.loggedIn=!0)},function(t){e.user.name="",e.loggedIn=!1})}var s;e.user={},e.user.name="",e.loggedIn=!1,e.title="",e.init=function(){l()},e.showLoginBottomSheet=function(e){a.showLoadingBottomSheet(e)},e.openMenu=function(e,t){s=t,e(t)},e.goTo=function(o){t.url(o),e.toggle()},e.goToExternal=function(e){window.open(e,"_blank")},r.$on("navbarTitle",function(t,o){e.title=o}),r.$on("loggedin",function(e,t){l()}),e.logout=function(){n.logout().then(function(e){},function(e){console.log(e)})},e.areWeLoggedIn=function(){n.getUser().then(function(t){e.loggedIn=!0})["catch"](function(t){e.loggedIn=!1})},e.openSideBar=function(e){i(e).open()},e.closeSideBar=function(e){i(e).close()},e.toggle=c("left"),e.init()}]),angular.module("BossCollection.controllers").controller("rosterController",["$scope","filterFilter","socketProvider","guildServices","$http","$cookies","$location","siteServices",function(e,t,o,n,r,i,a,c){function l(){var t=i.getObject("ranksList");t&&(e.raiderRanks=t.raiderRanks,e.trialRanks=t.trialRanks,e.guild=t.guild,e.realm=t.realm)}c.updateTitle("Guild Roster"),e.currentRosterDropdown=!0,e.applicantsDropdown=!1;var s=["placeholder","warrior","paladin","hunter","rogue","priest","death knight","shaman","mage","warlock","monk","druid"];e.raiders=[],e.trials=[],e.trialRanks=[9],e.raiderRanks=[0,2,6],e.guild="mkdir bosscollection",e.realm="zul'jin",e.loading=!0,e.genders=["Male","Female"],l(),$("ul.tabs").tabs(),e.getMembers=function(){e.raiders=[],e.trials=[],e.loading=!0,n.getGuild(e.realm,e.guild).then(function(t){console.log(t),e.loading=!1,d(t)},function(t){e.loading=!1,console.log(t)})},e.getUser=function(){r({method:"POST",url:"/getUser"}).success(function(e){console.log(e)})},e.openArmoryProfile=function(e,t){var o="http://us.battle.net/wow/en/character/"+t+"/"+e+"/simple";window.open(o)},e.saveRanksList=function(){var t={guild:e.guild,realm:e.realm,trialRanks:e.trialRanks,raiderRanks:e.raiderRanks};i.putObject("ranksList",t)};var u=function(t,o,n){try{var r={name:t.character.name,"class":n.charAt(0).toUpperCase()+n.slice(1),rank:o,gender:e.genders[t.character.gender],race:t.character.race,spec:t.character.spec.name,achievementPoints:t.character.achievementPoints,avatar:"http://us.battle.net/static-render/us/"+t.character.thumbnail};return r}catch(i){console.log(t)}},d=function(t){for(var o=0;o<t.length;o++){var n=t[o].rank,r=_.find(e.raiderRanks,function(e){return n==e}),i=_.find(e.trialRanks,function(e){return n==e}),a=s[t[o].character["class"]];r&&e.raiders.push(u(t[o],n,a)),i&&e.trials.push(u(t[o],n,a))}e.raiders.sort(function(e,t){return e.rank-t.rank})};e.lowLvlTrials=[],e.getMembers()}]),angular.module("BossCollection.controllers").controller("editAccountController",["$scope","$location","$http","userLoginSrvc","siteServices","guildServices",function(e,t,o,n,r,i){r.updateTitle("Account"),e.leaveGuild=function(){var t=e.user.guild.name;i.leaveGuild(t).then(function(t){e.user=n.updateUser()})},e.updateAccount=function(){console.log("Updating account"),n.updateAccount(e.user).then(function(t){e.user=n.updateUser(),r.showMessageToast("User updated")},function(e){r.showMessageModal(e)})}}]),angular.module("BossCollection.controllers").controller("loginController",["$scope","$location","$http","userLoginSrvc","siteServices","$mdBottomSheet","$timeout",function(e,t,o,n,r,i,a){e.user={},e.user.name="",e.loading=!1,"/auth/login"==t.url()&&r.updateTitle("Login"),console.log("Login Controller"),e.init=function(){},e.resetPassword=function(){e.loading=!0,n.lostPassword(e.user.email).then(function(e){r.showMessageModal("Email has been sent. Refer to your email for your temporary password.")})["catch"](function(e){r.showMessageModal(e)})["finally"](function(){e.loading=!1})},e.alreadyLoggedIn=function(){1==n.loggedIn()&&t.path("/")},e.openPasswordResetWindow=function(e){i.show({templateUrl:"resetPassword",controller:"loginController",targetEvent:e,escapeToClose:!1})},e.cancelPasswordReset=function(){i.hide(),a(function(){r.showLoadingBottomSheet()},500)},e.login=function(){n.login(e.user).then(function(e){console.log(e),n.getUser().then(function(){"/auth/application"==t.path()||t.path("/")})},function(e){r.showMessageModal(e),console.log(e)})},e.cancelLogin=function(){r.hideBottomSheet(),t.path("/")}}]),angular.module("BossCollection.controllers").controller("signupController",["$scope","$location","$http","$timeout","userLoginSrvc","siteServices",function(e,t,o,n,r,i){e.user={},e.passwordsMatch=!1,$("#logInModal").closeModal(),e.register=function(){r.registerNewUser(e.user).then(function(e){console.log(e)},function(t){e.passwordsMatch=!0,e.openFromLeft(t),console.log(t)})},e.openFromLeft=function(e){i.showMessageModal(e)}}]),angular.module("BossCollection.controllers").controller("applicationController",["$scope","$location","$http","$timeout","$filter","realmServices","guildServices","userLoginSrvc","siteServices",function(e,t,o,n,r,i,a,c,l){l.updateTitle("Applications"),console.log("Loading application ctrl..."),e.application={},e.validCharacterName=!1,e.charRequirementsIncomplete=!1,e.charRealmError=!1,e.searchingForUser=!1,e.icon="error",e.init=function(){i.getRealms().then(function(t){e.realms=t}).then(function(){return e.loggedIn()})["catch"](function(e){console.log(e)})["finally"](function(){n(function(){l.hideLoadingModal()},500)})},e.filterSearch=function(t){return r("filter")(e.realms,t)},e.loggedIn=function(){c.getUser().then(function(e){})["catch"](function(e){l.showMessageModal("Please log in before attempting to apply."),t.path("/")})["finally"](function(){})},e.validateCharactername=function(t){e.application.realm?(e.validCharacterName=!1,e.searchingForUser=!0,a.validateCharacterName(e.application.characterName,e.application.realm.name).then(function(o){e.validCharacterName=!0,e.icon="check_circle",e.application.character=o,t&&t()},function(t){e.icon="error",l.showMessageToast(t),e.validCharacterName=!1})["finally"](function(){e.searchingForUser=!1})):(e.validCharacterName=!1,t&&t())},e.submitApplication=function(){e.validateCharactername(function(){0==e.validCharacterName?l.showMessageToast("Sorry, we couldn't find your character. Please verify your Realm and Character are correct."):a.submitApplication(e.application).then(function(e){t.path("/reviewApplications")},function(e){l.showMessageToast(e)})})},e.init()}]),angular.module("BossCollection.controllers").controller("applicationsReviewController",["$scope","$location","$http","$timeout","guildServices","siteServices",function(e,t,o,n,r,i){function a(){for(var t=0;t<e.applications.length;t++){var o=c[e.applications[t].character["class"]];e.applications[t].character["class"]=o.charAt(0).toUpperCase()+o.slice(1)}}i.updateTitle("View Applications");var c=["placeholder","warrior","paladin","hunter","rogue","priest","death knight","shaman","mage","warlock","monk","druid"];e.loading=!0,e.openComments=function(e){i.showMessageModal(e,"Comments")},e.goTo=function(e){var t=window.open(e,"_blank");t.focus()},e.buildArmoryUrl=function(t,o){var n="http://us.battle.net/wow/en/character/"+t+"/"+o+"/simple";e.goTo(n)},r.getApplications().then(function(t){e.loading=!1,e.applications=t.applications,console.log(e.applications),a()},function(t){e.loading=!1,console.log(t),i.showMessageToast("Seems something broke. Try again in a few...")})}]),angular.module("BossCollection.controllers").controller("createGuildController",["$scope","$location","$http","$timeout","siteServices","guildServices","userLoginSrvc",function(e,t,o,n,r,i,a){r.updateTitle("Create Guild"),e.guildName="",e.loading=!1,e.joinGuild=function(){e.loading=!0,i.createGuild(e.guildName).then(function(){var e=a.updateUser();r.showMessageModal("Successfully created "+e.guild.name),t.path("/")})["catch"](function(e){r.showMessageModal(e)})["finally"](function(){e.loading=!1})}}]),angular.module("BossCollection.controllers").controller("joinGuildController",["$scope","$location","$http","$timeout","siteServices","guildServices","userLoginSrvc","$filter",function(e,t,o,n,r,i,a,c){e.listOfGuilds=[],e.loading=!1,r.updateTitle("Join Guild"),e.init=function(){e.getGuilds()},e.filterSearch=function(t){return c("filter")(e.listOfGuilds,t)},e.getGuilds=function(){i.getListOfGuilds().then(function(t){e.listOfGuilds=t})},e.joinGuild=function(){e.loading=!0,e.guildName?i.joinGuild(e.guildName.name,e.user.name).then(function(o){r.showMessageModal("Success! You will be able to access the guild services once you've been promoted to member."),a.updateUser(e.user),t.path("/")})["catch"](function(e){r.showMessageModal(e)})["finally"](function(){e.loading=!1}):(r.showMessageToast("Guild doesn't exist"),e.loading=!1)},e.init()}]),angular.module("BossCollection.controllers").controller("manageMembersController",["$scope","$location","$http","$timeout","siteServices","guildServices","userLoginSrvc","$filter",function(e,t,o,n,r,i,a,c){e.guildMembers,e.ranks=["Applicant","Member","Officer","GM"],e.init=function(){""!=e.user.name?i.getGuildMembers(e.user.guild.name).then(function(t){e.guildMembers=t}):a.getUser().then(function(t){i.getGuildMembers(t.guild.name).then(function(t){e.guildMembers=t})})},e.promote=function(t){3==t.rank?r.showMessageModal("Can't promote any further"):(t.rank++,i.updateRank(e.user.guild.name,t).then(function(){})["catch"](function(e){r.showMessageModal(e)}))},e.demote=function(t){1==t.rank?r.showMessageModal("Can't demote any further. They are effectively kicked at this rank."):(t.rank--,i.updateRank(e.user.guild.name,t).then(function(){})["catch"](function(e){r.showMessageModal(e)}))},e.init(),r.updateTitle("Manage Members")}]),angular.module("BossCollection.controllers").controller("strategyRoomController",["$scope",function(e){}]),angular.module("BossCollection.controllers").controller("bossStrategyController",["$scope","bossStrats","socketProvider","$routeParams",function(e,t,o,n){function r(){for(var t in e.raidToDisplay)e.raidToDisplay[t].isSelected=!1}function i(){document.getElementById("sideNavID").style.height=window.outerHeight/2+"px"}function a(e){return/(?:https?:\/\/|www\.|m\.|^)youtu(?:be\.com\/watch\?(?:.*?&(?:amp;)?)?v=|\.be\/)([\w‌​\-]+)(?:&(?:amp;)?[\w\?=]*)?/.test(e)}e.highmaulBossSelected=!1,e.brfBossSelected=!1,e.hfcBossSelected=!1,$(".modal-trigger").leanModal();var c=n.raid;e.highmaul="hm",e.brf="brf",e.hfc="hfc",e.bossInfo={},e.loadChat=!1,e.difficultySelected="",e.currentEmbedUrl="",e.addNewBoss=!1,e.currentRaid={},e.raidToDisplay={},e.name="",e.url="",e.init=function(){i(),t.getStrats(c).then(function(t){e.raidToDisplay=t.bosses,e.raidData=t,r()})},e.addVideo=function(t,o,n){e.currentBoss=t,e.currentDifficulty=o,e.currentRaid=n},e.saveNewBossInfo=function(o,n,r,i){if(console.log(r),a(n)){var c=n.split("&");c=c[0].split("="),n=c[1],"heroic"==i?r.heroic.videos[r.heroic.videos.length]={name:o,url:n}:"mythic"==i&&(r.mythic.videos[r.mythic.videos.length]={name:o,url:n}),e.raidData.bosses=e.raidToDisplay,console.log(e.raidData),t.saveStrats(e.raidData,n),e.addNewBoss=!1,e.name="",e.url="",e.addNewBoss=!e.addNewBoss}else $("#urlInput").popover("show")},e.changeBossInfo=function(t,o){t.isSelected=!t.isSelected,e.bossSelected=t.name,e.addNewBoss=!1},e.changeDifficulty=function(e,t){e.difficultySelected=t,"- Heroic"==t?(e.heroic.isSelected=!e.heroic.isSelected,e.mythic.isSelected=!1):(e.mythic.isSelected=!e.mythic.isSelected,e.heroic.isSelected=!1)},e.setUrl=function(t){e.currentEmbedUrl=t},e.open=function(t){e.setUrl(t),console.log(t),$("#bossVideo").openModal()},e.init()}]),angular.module("BossCollection.controllers").controller("bossStrategyController",["$scope","bossStrats","$modal","socketProvider","$routeParams",function(e,t,o,n,r){function i(){for(var t in e.raidToDisplay)e.raidToDisplay[t].isSelected=!1}function a(){document.getElementById("sideNavID").style.height=window.outerHeight/2+"px"}function c(e){return/(?:https?:\/\/|www\.|m\.|^)youtu(?:be\.com\/watch\?(?:.*?&(?:amp;)?)?v=|\.be\/)([\w‌​\-]+)(?:&(?:amp;)?[\w\?=]*)?/.test(e)}e.highmaulBossSelected=!1,e.brfBossSelected=!1,e.hfcBossSelected=!1;var l=r.raid;e.highmaul="hm",e.brf="brf",e.hfc="hfc",e.bossInfo={},e.loadChat=!1,e.difficultySelected="",e.currentEmbedUrl="",e.addNewBoss=!1,e.currentRaid={},e.raidToDisplay={},e.name="",e.url="",e.init=function(){a(),t.getStrats(l).then(function(t){e.raidToDisplay=t.bosses,e.raidData=t,i()})},e.addVideo=function(t,o,n){e.currentBoss=t,e.currentDifficulty=o,e.currentRaid=n},e.saveNewBossInfo=function(o,n,r,i){if(console.log(r),c(n)){var a=n.split("&");a=a[0].split("="),n=a[1],"heroic"==i?r.heroic.videos[r.heroic.videos.length]={name:o,url:n}:"mythic"==i&&(r.mythic.videos[r.mythic.videos.length]={name:o,url:n}),e.raidData.bosses=e.raidToDisplay,console.log(e.raidData),t.saveStrats(e.raidData,n),e.addNewBoss=!1,e.name="",e.url="",e.addNewBoss=!e.addNewBoss}else $("#urlInput").popover("show")},e.changeBossInfo=function(t,o){t.isSelected=!t.isSelected,e.bossSelected=t.name,e.addNewBoss=!1},e.changeDifficulty=function(e,t){e.difficultySelected=t,"- Heroic"==t?(e.heroic.isSelected=!e.heroic.isSelected,e.mythic.isSelected=!1):(e.mythic.isSelected=!e.mythic.isSelected,e.heroic.isSelected=!1)},e.setUrl=function(t){e.currentEmbedUrl=t},e.open=function(t){e.setUrl(t),console.log(t);o.open({templateUrl:"videoModal",controller:"videoController",size:"lg",windowClass:"videoModal",resolve:{currentUrl:function(){return e.currentEmbedUrl}}})},e.init()}]),angular.module("BossCollection.controllers").controller("videoController",["$scope","currentUrl","$modalInstance",function(e,t,o){e.url=t,e.getIframeSrc=function(){return"https://www.youtube.com/embed/"+e.url},e.close=function(){o.dismiss("cancel")},e.embedUrl=e.url}]),angular.module("BossCollection.directives",[]),angular.module("BossCollection.directives").directive("ad",[function(){return{restrict:"E",template:'<ins class="adsbygoogle"style="display:block;"data-ad-client="ca-pub-4895481554192451"data-ad-slot="1814022675"data-ad-format="auto">',link:function(e,t,o){try{(adsbygoogle=window.adsbygoogle||[]).push({});
}catch(n){console.log("Add code broke"),console.log(n)}}}}]),angular.module("BossCollection.directives").directive("bossstrategies",[function(){return{restrict:"E",templateUrl:"bossStrategy",controller:"bossStrategyController",link:function(e,t,o){}}}]),angular.module("BossCollection.directives").directive("logIn",[function(){return{restrict:"E",templateUrl:"login",controller:"loginController",link:function(e,t,o){}}}]),angular.module("BossCollection.directives").directive("myEnter",function(){return function(e,t,o){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(o.myEnter)}),t.preventDefault())})}}),angular.module("BossCollection.directives").directive("displayMarkdown",["$sce",function(e){return{restrict:"E",scope:{markdown:"=markdown"},link:function(t){var o=new showdown.Converter;t.converToHtml=function(){t.html=e.trustAsHtml(o.makeHtml(t.markdown))},t.converToHtml(t.markdown)},templateUrl:"displayMarkdownDirective"}}]),angular.module("BossCollection.directives").directive("inputMarkdown",["$sce",function(e){return{restrict:"E",scope:{input:"=input"},link:function(t){var o=new showdown.Converter;t.markdown=t.input,t.showPreview=!0,t.goToExternal=function(e){window.open(e,"_blank")},t.converToHtml=function(){t.html=e.trustAsHtml(o.makeHtml(t.markdown)),t.input=t.markdown},t.hideShowPreview=function(){t.showPreview=!t.showPreview},t.converToHtml(t.markdown)},templateUrl:"inputField"}}]),angular.module("BossCollection.filters",[]),angular.module("BossCollection.filters").filter("applicants",[function(){return function(e){var t=[];return t=_.filter(e,function(e){return 1==e.rank}),t.length}}]),angular.module("BossCollection.filters").filter("interpolate",function(e){return function(t){return String(t).replace(/\%VERSION\%/gm,e)}}),angular.module("BossCollection.services",[]),angular.module("BossCollection.services").factory("bossStrats",["socketProvider","$resource","$q",function(e,t,o){var n=t("/api/bossStrats",{},{update:{method:"PUT"}}),r={getStrats:function(e){var t=o.defer();console.log("Request Boss Info");var r={name:e};return n.save(r).$promise.then(function(e){console.log("Result: "),console.log(e),t.resolve(e.result)}),t.promise},saveStrats:function(e,t){console.log("Saving info now");var o={raidData:e,url:t};o=angular.toJson(o),console.log(o),n.data=o,n.update(o,function(e){console.log("Result: "+e)})}};return r}]),angular.module("BossCollection.services").factory("guildServices",["$http","$q","$resource","siteServices","userLoginSrvc","socketProvider",function(e,t,o,n,r,i){var a="https://us.api.battle.net/wow/guild/",c="?fields=members&locale=en_US&apikey=fqvadba9c8auw7brtdr72vv7hfntbx7d",l=o("/api/applicationSubmission",{},{}),s=o("/api/getApplications",{},{}),u=o("/api/addGuild",{},{}),d=o("/api/updateRank",{},{}),f=(o("/api/changeGuildName",{},{}),o("/api/addMember",{},{})),m=o("/api/removeMember",{},{}),g=o("/api/getGuildMembers",{},{}),h=o("/api/listOfGuilds",{},{}),p={getListOfGuilds:function(){var e=t.defer();return n.startLoading(),h.get().$promise.then(function(t){e.resolve(t.guilds)})["catch"](function(t){e.reject(t.data.message)})["finally"](function(){n.loadingFinished()}),e.promise},updateRank:function(e,o){var r=t.defer();return d.save({guildName:e,member:o}).$promise.then(function(e){r.resolve(e.members)})["catch"](function(e){r.reject(e.data.message)})["finally"](function(){n.loadingFinished()}),r.promise},getGuildMembers:function(e){var o=t.defer();return n.startLoading(),g.save({guildName:e}).$promise.then(function(e){o.resolve(e.members)})["catch"](function(e){o.reject(e.data.message)})["finally"](function(){n.loadingFinished()}),o.promise},createGuild:function(e){var o=t.defer();return u.save({guildName:e}).$promise.then(function(e){o.resolve(e.guild)})["catch"](function(e){o.reject(e.data.message)})["finally"](function(){}),o.promise},joinGuild:function(e,o){var n=t.defer();return f.save({guildName:e,memberName:o}).$promise.then(function(e){n.resolve(e.guild)})["catch"](function(e){n.reject(e.data.message)})["finally"](function(){}),n.promise},leaveGuild:function(e){var o=t.defer();return n.startLoading(),m.save({guildName:e}).$promise.then(function(e){o.resolve(e.user)})["catch"](function(e){o.reject(e.data.message)})["finally"](function(){n.loadingFinished()}),o.promise},getApplications:function(){var e=t.defer();return n.startLoading(),s.get().$promise.then(function(t){e.resolve(t)},function(t){e.reject(t)})["finally"](function(){n.loadingFinished()}),e.promise},validateCharacterName:function(e,n){var r=t.defer(),i="https://us.api.battle.net/wow/character/"+n+"/"+e+"?locale=en_US&apikey=fqvadba9c8auw7brtdr72vv7hfntbx7d",a=o(i,{},{});return a.get().$promise.then(function(e){r.resolve(e)},function(e){r.reject("Character not found")}),r.promise},getGuild:function(o,r){var i=t.defer();if(n.startLoading(),""!=o&&""!=r)var l=a+encodeURIComponent(o)+"/"+encodeURIComponent(r)+c;return e({method:"GET",url:l}).then(function(e){i.resolve(e.data.members)},function(e){i.reject(e)})["finally"](function(){n.loadingFinished()}),i.promise},submitApplication:function(e){var r=t.defer(),i="https://us.api.battle.net/wow/character/"+e.realm.name+"/"+e.character.name+"?fields=talents&locale=en_US&apikey=fqvadba9c8auw7brtdr72vv7hfntbx7d",a=o(i,{},{});return n.startLoading(),a.get().$promise.then(function(e){return e},function(e){r.reject("Character not found")}).then(function(t){e.character.specs=t.talents,l.save({newApplicant:e}).$promise.then(function(e){n.loadingFinished(),r.resolve(e)},function(e){r.reject(e)})})["finally"](function(){n.loadingFinished()}),r.promise}};return p}]),angular.module("BossCollection.services").factory("realmServices",["$http","$q","siteServices",function(e,t,o){var n="https://us.api.battle.net/wow/realm/status?locale=en_US&apikey=fqvadba9c8auw7brtdr72vv7hfntbx7d",r=[],i={getRealms:function(){var i=t.defer();return 0==r.length?e({method:"GET",url:n}).success(function(e){o.hideLoadingModal(),r=e.realms,i.resolve(r),r=r}):(o.hideLoadingModal(),i.resolve(r)),i.promise}};return i}]),angular.module("BossCollection.services").factory("siteServices",["$rootScope","$mdBottomSheet","$mdDialog","$mdToast",function(e,t,o,n){function r(){g||(g=!0,m())}function i(){f(),g=!1}function a(t){e.$broadcast("navbarTitle",t)}function c(e){t.show({templateUrl:"logInModal",controller:"loginController",targetEvent:e,escapeToClose:!1})}function l(){t.hide()}function s(){t.hide()}function u(e,t){o.show(o.alert().clickOutsideToClose(!0).title(t).textContent(e).ariaLabel("message popup").ok("Got it!").openFrom({left:-50,width:30,height:80}).closeTo({right:1500}))}function d(e){n.show(n.simple().textContent(e).position("top").hideDelay(4e3))}function f(){0==g||(g=!1,o.hide())}function m(){o.show({templateUrl:"loadingModal",onComplete:function(){g||o.hide()}})}var g=!1;return{startLoading:r,loadingFinished:i,updateTitle:a,showLoadingBottomSheet:c,hideLoadingBottomSheet:l,showMessageModal:u,showMessageToast:d,hideBottomSheet:s,showLoadingModal:m,hideLoadingModal:f}}]),angular.module("BossCollection.services").factory("socketProvider",[function(){var e=io("http://localhost:4001/guilds");return e}]),angular.module("BossCollection.services").factory("userLoginSrvc",["$resource","$q","$location","$cookies","$rootScope","siteServices","socketProvider",function(e,t,o,n,r,i,a){function c(){var e=n.get("user"),t=void 0;if(e){var o=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1);t=JSON.parse(o)}return t}function l(e){var t;return h&&h.guild?(t=_.find(h.guild.members,{user:h.name}),h.rank=t.rank,t.rank):e&&e.guild?(t=_.find(h.guild.members,{user:h.name}),t.rank):0}var s=e("/auth/signup",{},{}),u=e("/auth/login",{},{}),d=e("/auth/logout",{},{}),f=(e("/auth/loggedin",{},{}),e("/auth/updateAccount",{},{})),m=e("/auth/currentUser",{},{}),g=e("/auth/lost-password",{},{}),h=null,p={lostPassword:function(e){var o=t.defer();return g.save({email:e}).$promise.then(function(e){o.resolve(e)},function(e){o.reject(e.data.message)}),o.promise},updateAccount:function(e){var o=t.defer();return i.startLoading(),f.save(e).$promise.then(function(e){o.resolve(e)},function(e){console.log(e),o.reject(e.data.message)})["finally"](function(){i.loadingFinished()}),o.promise},updateUser:function(){return h=c(),h&&h.guild&&l(h),r.$broadcast("loggedin",{user:h,loggedIn:!0}),h},getUser:function(){var e=t.defer();return h=c(),h?(h&&h.guild&&l(h),e.resolve(h)):e.reject("User doesn't exist"),e.promise},refreshUserFromServer:function(){var e=t.defer();return i.startLoading(),m.get().$promise.then(function(t){p.updateUser(),e.resolve()},function(t){console.log(t),e.reject(t)})["finally"](function(){i.loadingFinished()}),e.promise},logout:function(){var e=t.defer();return i.startLoading(),h=null,d.save({}).$promise.then(function(e){1==e.loggedOut&&r.$broadcast("loggedin",{loggedIn:!1}),o.path("/")},function(e){r.$broadcast("loggedin",{loggedIn:!1}),o.path("/")})["finally"](function(){i.loadingFinished()}),e.promise},registerNewUser:function(e){var n=t.defer();return console.log("Register new user"),i.startLoading(),s.save(e).$promise.then(function(e){h=c(),l(h),p.updateUser(),o.path("/")},function(e){console.log(e.data),n.reject(e.data)})["finally"](function(){i.loadingFinished()}),n.promise},login:function(e){var o=t.defer();return i.startLoading(),u.save(e).$promise.then(function(e){h=c(),l(h),r.$broadcast("loggedin",{user:h,loggedIn:!0}),i.hideLoadingBottomSheet()},function(e){o.reject(e.data)})["finally"](function(){i.loadingFinished()}),o.promise}};return p.refreshUserFromServer(),p}]);