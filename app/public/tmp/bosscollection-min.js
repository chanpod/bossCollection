"use strict";angular.module("BossCollection",["BossCollection.controllers","BossCollection.services","BossCollection.directives","ngRoute","ngResource","btford.socket-io","ngCookies"]).factory("mySocket",["socketFactory",function(e){return e()}]).config(["$routeProvider","$locationProvider","$httpProvider","$sceDelegateProvider",function(e,o,t,r){e.when("/",{templateUrl:"home",controller:"homeController"}).when("/strategyRoom/:raid",{templateUrl:"strategyRoom",controller:"strategyRoomController"}).when("/roster",{templateUrl:"roster",controller:"rosterController"}).when("/auth/login",{templateUrl:"login",controller:"loginController"}).when("/auth/signup",{templateUrl:"signup",controller:"signupController"}).when("/forum",{templateUrl:"forums",controller:"forumsController"}).when("/auth/updateAccount",{templateUrl:"editAccount",controller:"editAccountController"}).when("/auth/application",{templateUrl:"application",controller:"applicationController"}).when("/reviewApplications",{templateUrl:"reviewApplications",controller:"applicationsReviewController"}).otherwise({redirectTo:"/"}),o.hashPrefix("!"),r.resourceUrlWhitelist(["self","https://www.youtube.com/**","https://pagead2.googlesyndication.com"]),o.html5Mode(!0)}]),angular.module("BossCollection.controllers",[]),angular.module("BossCollection.controllers").controller("homeController",["$scope","$location","$http","$timeout",function(e,o,t,r){try{(adsbygoogle=window.adsbygoogle||[]).push({})}catch(n){}$(".parallax").parallax();var l=[{selector:"#staggered-test",offset:50,callback:'Materialize.toast("This is our ScrollFire Demo!", 1500 )'},{selector:"#staggered-test",offset:205,callback:'Materialize.toast("Please continue scrolling!", 1500 )'},{selector:"#staggered-test",offset:400,callback:'Materialize.showStaggeredList("#staggered-test")'},{selector:"#image-test",offset:500,callback:'Materialize.fadeInImage("#image-test")'}];Materialize.scrollFire(l)}]),angular.module("BossCollection.controllers").controller("navbar",["$scope","$location","$http","userLoginSrvc","$rootScope",function(e,o,t,r,n){console.log("Working?"),e.user={},e.user.name=r.getUser(),e.loggedIn=!1,n.$on("loggedin",function(o,t){console.log(t),t.name?e.user.name=t.name:e.user.name=r.getUser(),e.loggedIn=t.loggedIn}),e.logout=function(){r.logout().then(function(e){},function(e){console.log(e)})},e.areWeLoggedIn=function(){r.currentlyLoggedIn().then(function(o){console.log(o),e.loggedIn=o})},e.areWeLoggedIn()}]),angular.module("BossCollection.controllers").controller("rosterController",["$scope","filterFilter","socketProvider","guildServices","$http","$cookies","$location",function(e,o,t,r,n,l,a){function i(){var o=l.getObject("ranksList");o&&(e.raiderRanks=o.raiderRanks,e.trialRanks=o.trialRanks,e.guild=o.guild,e.realm=o.realm)}e.currentRosterDropdown=!0,e.applicantsDropdown=!1;var s=["placeholder","warrior","paladin","hunter","rogue","priest","death knight","shaman","mage","warlock","monk","druid"];e.raiders=[],e.trials=[],e.trialRanks=[9],e.raiderRanks=[0,2,6],e.guild="mkdir bosscollection",e.realm="zul'jin",e.loading=!0,e.genders=["Male","Female"],i(),$("ul.tabs").tabs(),e.getMembers=function(){e.raiders=[],e.trials=[],e.loading=!0,r.getGuild(e.realm,e.guild).then(function(o){console.log(o),e.loading=!1,u(o)},function(o){e.loading=!1,console.log(o)})},e.getUser=function(){n({method:"POST",url:"/getUser"}).success(function(e){console.log(e)})},e.openArmoryProfile=function(e,o){var t="http://us.battle.net/wow/en/character/"+o+"/"+e+"/simple";window.open(t)},e.saveRanksList=function(){var o={guild:e.guild,realm:e.realm,trialRanks:e.trialRanks,raiderRanks:e.raiderRanks};l.putObject("ranksList",o)};var c=function(o,t,r){try{var n={name:o.character.name,"class":r.charAt(0).toUpperCase()+r.slice(1),rank:t,gender:e.genders[o.character.gender],race:o.character.race,spec:o.character.spec.name,achievementPoints:o.character.achievementPoints,avatar:"http://us.battle.net/static-render/us/"+o.character.thumbnail};return n}catch(l){console.log(o)}},u=function(o){for(var t=0;t<o.length;t++){var r=o[t].rank,n=_.find(e.raiderRanks,function(e){return r==e}),l=_.find(e.trialRanks,function(e){return r==e}),a=s[o[t].character["class"]];n&&e.raiders.push(c(o[t],r,a)),l&&e.trials.push(c(o[t],r,a))}e.raiders.sort(function(e,o){return e.rank-o.rank})};e.lowLvlTrials=[],e.getMembers()}]),angular.module("BossCollection.controllers").controller("applicationController",["$scope","$location","$http","$timeout","realmServices","guildServices","userLoginSrvc",function(e,o,t,r,n,l,a){console.log("Loading application ctrl..."),e.application={};try{(adsbygoogle=window.adsbygoogle||[]).push({})}catch(i){}e.validCharacterName=!1,n.getRealms().then(function(o){e.realms=o,r(function(){$("select").material_select()},100)}),e.areWeLoggedIn=function(){a.currentlyLoggedIn().then(function(e){1==e||$("#logInModal").openModal({dismissible:!1,opacity:.5,in_duration:300,out_duration:200,complete:function(){}})})},e.validateCharactername=function(){e.validCharacterName=!1,l.validateCharacterName(e.application.characterName,e.application.realm.name).then(function(o){e.validCharacterName=!0,e.application.character=o},function(o){e.validCharacterName=!1})},e.submitApplication=function(){0==e.validCharacterName?Materialize.toast("Sorry, we couldn't find your character. Please verify your Realm and Character are correct."):l.submitApplication(e.application).then(function(e){o.path("/reviewApplications")},function(e){Materialize.toast(e)})},e.areWeLoggedIn()}]),angular.module("BossCollection.controllers").controller("applicationsReviewController",["$scope","$location","$http","$timeout","guildServices",function(e,o,t,r,n){function l(){for(var o=0;o<e.applications.length;o++){var t=i[e.applications[o].character["class"]];e.applications[o].character["class"]=t.charAt(0).toUpperCase()+t.slice(1)}}try{(adsbygoogle=window.adsbygoogle||[]).push({})}catch(a){}var i=["placeholder","warrior","paladin","hunter","rogue","priest","death knight","shaman","mage","warlock","monk","druid"];e.loading=!0,n.getApplications().then(function(o){e.loading=!1,e.applications=o.applications,console.log(e.applications),l()},function(o){e.loading=!1,console.log(o),Materialize.toast("Seems something broke. Try again in a few...")})}]),angular.module("BossCollection.controllers").controller("editAccountController",["$scope","$location","$http","userLoginSrvc",function(e,o,t,r){r.getUser().then(function(o){console.log("Got the user"),e.user=o}),e.updateAccount=function(){console.log("Updating account"),r.updateAccount(e.user).then(function(e){Materialize.toast("User updated")},function(e){Materialize.toast(e)})},e.alreadyLoggedIn=function(){1!=r.loggedIn()&&o.path("/auth/login")}}]),angular.module("BossCollection.controllers").controller("loginController",["$scope","$location","$http","userLoginSrvc",function(e,o,t,r){e.user={},e.user=r.getUser(),e.alreadyLoggedIn=function(){1==r.loggedIn()&&o.path("/")},e.login=function(){r.login(e.user).then(function(e){console.log(e),"/auth/application"==o.path()?$("#logInModal").closeModal():o.path("/")},function(e){Materialize.toast(e),console.log(e)})}}]),angular.module("BossCollection.controllers").controller("signupController",["$scope","$location","$http","$timeout","userLoginSrvc",function(e,o,t,r,n){e.user={},$("#logInModal").closeModal(),e.register=function(){n.registerNewUser(e.user).then(function(e){console.log(e)},function(e){Materialize.toast(e),console.log(e)})}}]),angular.module("BossCollection.controllers").controller("forumsController",["$scope","$location","$http","userLoginSrvc","$rootScope",function(e,o,t,r,n){e.user.name=r.getUser(),void 0==e.user.name&&o.path("/")}]),angular.module("BossCollection.controllers").controller("strategyRoomController",["$scope",function(e){}]),angular.module("BossCollection.controllers").controller("bossStrategyController",["$scope","bossStrats","socketProvider","$routeParams",function(e,o,t,r){function n(){for(var o in e.raidToDisplay)e.raidToDisplay[o].isSelected=!1}function l(){document.getElementById("sideNavID").style.height=window.outerHeight/2+"px"}function a(e){return/(?:https?:\/\/|www\.|m\.|^)youtu(?:be\.com\/watch\?(?:.*?&(?:amp;)?)?v=|\.be\/)([\w‌​\-]+)(?:&(?:amp;)?[\w\?=]*)?/.test(e)}e.highmaulBossSelected=!1,e.brfBossSelected=!1,e.hfcBossSelected=!1,$(".modal-trigger").leanModal();try{(adsbygoogle=window.adsbygoogle||[]).push({})}catch(i){console.log("Google broke again")}var s=r.raid;e.highmaul="hm",e.brf="brf",e.hfc="hfc",e.bossInfo={},e.loadChat=!1,e.difficultySelected="",e.currentEmbedUrl="",e.addNewBoss=!1,e.currentRaid={},e.raidToDisplay={},e.name="",e.url="",e.init=function(){l(),o.getStrats(s).then(function(o){e.raidToDisplay=o.bosses,e.raidData=o,n()})},e.addVideo=function(o,t,r){e.currentBoss=o,e.currentDifficulty=t,e.currentRaid=r},e.saveNewBossInfo=function(t,r,n,l){if(console.log(n),a(r)){var i=r.split("&");i=i[0].split("="),r=i[1],"heroic"==l?n.heroic.videos[n.heroic.videos.length]={name:t,url:r}:"mythic"==l&&(n.mythic.videos[n.mythic.videos.length]={name:t,url:r}),e.raidData.bosses=e.raidToDisplay,console.log(e.raidData),o.saveStrats(e.raidData,r),e.addNewBoss=!1,e.name="",e.url="",e.addNewBoss=!e.addNewBoss}else $("#urlInput").popover("show")},e.changeBossInfo=function(o,t){o.isSelected=!o.isSelected,e.bossSelected=o.name,e.addNewBoss=!1},e.changeDifficulty=function(e,o){e.difficultySelected=o,"- Heroic"==o?(e.heroic.isSelected=!e.heroic.isSelected,e.mythic.isSelected=!1):(e.mythic.isSelected=!e.mythic.isSelected,e.heroic.isSelected=!1)},e.setUrl=function(o){e.currentEmbedUrl=o},e.open=function(o){e.setUrl(o),console.log(o),$("#bossVideo").openModal()},e.init()}]),angular.module("BossCollection.controllers").controller("bossStrategyController",["$scope","bossStrats","$modal","socketProvider","$routeParams",function(e,o,t,r,n){function l(){for(var o in e.raidToDisplay)e.raidToDisplay[o].isSelected=!1}function a(){document.getElementById("sideNavID").style.height=window.outerHeight/2+"px"}function i(e){return/(?:https?:\/\/|www\.|m\.|^)youtu(?:be\.com\/watch\?(?:.*?&(?:amp;)?)?v=|\.be\/)([\w‌​\-]+)(?:&(?:amp;)?[\w\?=]*)?/.test(e)}e.highmaulBossSelected=!1,e.brfBossSelected=!1,e.hfcBossSelected=!1;try{(adsbygoogle=window.adsbygoogle||[]).push({})}catch(s){console.log("Google broke again")}var c=n.raid;e.highmaul="hm",e.brf="brf",e.hfc="hfc",e.bossInfo={},e.loadChat=!1,e.difficultySelected="",e.currentEmbedUrl="",e.addNewBoss=!1,e.currentRaid={},e.raidToDisplay={},e.name="",e.url="",e.init=function(){a(),o.getStrats(c).then(function(o){e.raidToDisplay=o.bosses,e.raidData=o,l()})},e.addVideo=function(o,t,r){e.currentBoss=o,e.currentDifficulty=t,e.currentRaid=r},e.saveNewBossInfo=function(t,r,n,l){if(console.log(n),i(r)){var a=r.split("&");a=a[0].split("="),r=a[1],"heroic"==l?n.heroic.videos[n.heroic.videos.length]={name:t,url:r}:"mythic"==l&&(n.mythic.videos[n.mythic.videos.length]={name:t,url:r}),e.raidData.bosses=e.raidToDisplay,console.log(e.raidData),o.saveStrats(e.raidData,r),e.addNewBoss=!1,e.name="",e.url="",e.addNewBoss=!e.addNewBoss}else $("#urlInput").popover("show")},e.changeBossInfo=function(o,t){o.isSelected=!o.isSelected,e.bossSelected=o.name,e.addNewBoss=!1},e.changeDifficulty=function(e,o){e.difficultySelected=o,"- Heroic"==o?(e.heroic.isSelected=!e.heroic.isSelected,e.mythic.isSelected=!1):(e.mythic.isSelected=!e.mythic.isSelected,e.heroic.isSelected=!1)},e.setUrl=function(o){e.currentEmbedUrl=o},e.open=function(o){e.setUrl(o),console.log(o);t.open({templateUrl:"videoModal",controller:"videoController",size:"lg",windowClass:"videoModal",resolve:{currentUrl:function(){return e.currentEmbedUrl}}})},e.init()}]),angular.module("BossCollection.controllers").controller("videoController",["$scope","currentUrl","$modalInstance",function(e,o,t){e.url=o,e.getIframeSrc=function(){return"https://www.youtube.com/embed/"+e.url},e.close=function(){t.dismiss("cancel")},e.embedUrl=e.url}]),angular.module("BossCollection.directives",[]),angular.module("BossCollection.directives").directive("bossstrategies",[function(){return{restrict:"E",templateUrl:"bossStrategy",controller:"bossStrategyController",link:function(e,o,t){}}}]),angular.module("BossCollection.directives").directive("logIn",[function(){return{restrict:"E",templateUrl:"login",controller:"loginController",link:function(e,o,t){}}}]),angular.module("BossCollection.filters",[]),angular.module("BossCollection.filters").filter("interpolate",function(e){return function(o){return String(o).replace(/\%VERSION\%/gm,e)}}),angular.module("BossCollection.services",[]),angular.module("BossCollection.services").factory("bossStrats",["socketProvider","$resource","$q",function(e,o,t){var r=o("/api/bossStrats",{},{update:{method:"PUT"}}),n={getStrats:function(e){var o=t.defer();console.log("Request Boss Info");var n={name:e};return r.save(n).$promise.then(function(e){console.log("Result: "),console.log(e),o.resolve(e.result)}),o.promise},saveStrats:function(e,o){console.log("Saving info now");var t={raidData:e,url:o};t=angular.toJson(t),console.log(t),r.data=t,r.update(t,function(e){console.log("Result: "+e)})}};return n}]),angular.module("BossCollection.services").factory("guildServices",["$http","$q","$resource",function(e,o,t){var r="https://us.api.battle.net/wow/guild/",n="?fields=members&locale=en_US&apikey=fqvadba9c8auw7brtdr72vv7hfntbx7d",l=t("/api/applicationSubmission",{},{}),a=t("/api/getApplications",{},{}),i={getApplications:function(){var e=o.defer();return a.get().$promise.then(function(o){e.resolve(o)},function(o){e.reject(o)}),e.promise},validateCharacterName:function(e,r){var n=o.defer(),l="https://us.api.battle.net/wow/character/"+r+"/"+e+"?locale=en_US&apikey=fqvadba9c8auw7brtdr72vv7hfntbx7d",a=t(l,{},{});return a.get().$promise.then(function(e){n.resolve(e)},function(e){n.reject("Character not found")}),n.promise},getGuild:function(t,l){var a=o.defer();if(""!=t&&""!=l)var i=r+encodeURIComponent(t)+"/"+encodeURIComponent(l)+n;return e({method:"GET",url:i}).then(function(e){a.resolve(e.data.members)}),a.promise},submitApplication:function(e){var r=o.defer(),n="https://us.api.battle.net/wow/character/"+e.realm.name+"/"+e.character.name+"?fields=talents&locale=en_US&apikey=fqvadba9c8auw7brtdr72vv7hfntbx7d",a=t(n,{},{});return a.get().$promise.then(function(e){return e},function(e){r.reject("Character not found")}).then(function(o){e.character.specs=o.talents,l.save({newApplicant:e}).$promise.then(function(e){r.resolve(e)},function(e){r.reject(e)})}),r.promise}};return i}]),angular.module("BossCollection.services").factory("realmServices",["$http","$q",function(e,o){function t(){}var r="https://us.api.battle.net/wow/realm/status?locale=en_US&apikey=fqvadba9c8auw7brtdr72vv7hfntbx7d",n=[];t();var l={getRealms:function(){var t=o.defer();return 0==n.length?e({method:"GET",url:r}).success(function(e){n=e.realms,t.resolve(n),n=n}):t.resolve(n),t.promise}};return l}]),angular.module("BossCollection.services").factory("socketProvider",[function(){var e=io("http://bosscollection.net:4001");return e}]),angular.module("BossCollection.services").factory("userLoginSrvc",["$resource","$q","$location","$cookies","$rootScope",function(e,o,t,r,n){var l=e("/auth/signup",{},{}),a=e("/auth/login",{},{}),i=e("/auth/logout",{},{}),s=e("/auth/loggedin",{},{}),c=e("/auth/updateAccount",{},{}),u=e("/auth/currentUser",{},{}),d={updateAccount:function(e){var t=o.defer();return c.save(e).$promise.then(function(e){t.resolve(e)},function(e){console.log(e),t.reject(e.data)}),t.promise},getUser:function(){var e=o.defer();return u.get().$promise.then(function(o){console.log(o),e.resolve(o)}),e.promise},currentlyLoggedIn:function(){var e=o.defer(),t=!1;return s.save({}).$promise.then(function(o){1==o.loggedIn?(r.put("name",o.user.name),t=!0,n.$broadcast("loggedin",{name:o.user.name,loggedIn:!0})):t=!1,console.log(o),e.resolve(t)},function(o){console.log(o),e.reject(o)}),e.promise},logout:function(){var e=o.defer();return i.save({}).$promise.then(function(e){1==e.loggedOut&&n.$broadcast("loggedin",{loggedIn:!1}),t.path("/")},function(){console.log("WTF, delete cookies anyways..."),r.remove("name"),r.remove("password"),n.$broadcast("loggedin",{loggedIn:!1}),t.path("/")}),e.promise},registerNewUser:function(e){var r=o.defer();return console.log("Register new user"),l.save(e).$promise.then(function(e){console.log("Registration successfull. Redirecting to login page"),console.log(e),t.path("/auth/login")},function(e){console.log(e.data),r.reject(e.data)}),r.promise},login:function(e){var t=o.defer();return a.save(e).$promise.then(function(o){r.put("name",e.name),n.$broadcast("loggedin",{name:e.name,loggedIn:!0}),t.resolve(!0)},function(e){t.reject(e.data)}),t.promise}};return d}]);